<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MoonVeil Web API â€“ Full Obfuscation</title>
</head>
<body>
    <h1>MoonVeil Obfuscator (All Features Enabled)</h1>

    <textarea id="input" rows="12" cols="80"
        placeholder="Paste Lua / Luau script here..."></textarea>
    <br><br>

    <button id="run">Obfuscate</button>

    <h2>Output</h2>
    <textarea id="output" rows="12" cols="80" readonly></textarea>

    <script>
        document.getElementById("run").onclick = async () => {
            const script = document.getElementById("input").value;
            if (!script) return alert("Script is required.");

            try {
                const response = await fetch("https://moonveil.cc/api/obfuscate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer mv-secret-484470fb-0fa7-48ef-b203-90d96d2f42a1"
                    },
                    body: JSON.stringify({
                        script: script,
                        options: {
                            // Control Flow Flattening
                            cffEnable: true,
                            cffDecomposeExpr: true,
                            cffHoistLocals: true,

                            // Runtime
                            embedRuntime: true,

                            // Mangling
                            mangleEnable: true,
                            mangleGlobals: true,
                            mangleStrings: true,
                            mangleNumbers: true,
                            mangleNamedIndex: true,
                            mangleSelfCalls: true,

                            // Constant lifting level (0 = max)
                            mangleConstLift: 0,

                            // VM
                            vmWrapScript: true,
                            vmSafeEnv: true,
                            vmDebug: true,

                            // Output formatting
                            prettify: true
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(await response.text());
                }

                // API returns raw obfuscated script (text/plain)
                const obfuscated = await response.text();
                document.getElementById("output").value = obfuscated;

            } catch (err) {
                console.error(err);
                alert("Error: " + err.message);
            }
        };
    </script>
</body>
</html>

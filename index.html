function bot(text) {
  const m = document.createElement('div');
  m.className = 'message bot';

  const span = document.createElement('span');
  span.className = 'bot-text';
  m.appendChild(span);

  const time = ts();
  m.appendChild(time);

  messages.appendChild(m);
  messages.scrollTop = messages.scrollHeight;

  if (text) {
    if (text.length > 0) {
      typeFast(span, text);
    }
  }
}

async function handle(t) {
  if (t.startsWith('/ask ')) {
    const prompt = t.substring(5).trim();
    bot('AI thinking...');
    const aiAnswer = await aiReply(prompt);
    bot(aiAnswer);
  } else if (t.startsWith('/aicode')) {
    if (canvas.classList.contains('hidden')) {
      bot('Canvas disabled on mobile.');
    } else {
      bot('AI generating codeâ€¦');
      const prompt = t.replace('/aicode','').trim() || 'Write JS code';
      const aiCode = await aiReply(prompt);
      if (aiCode.split('\n').length > 100) {
        openCanvas();
        clearEditor();
        typeInEditor(aiCode);
        bot('AI code inserted into canvas.');
      } else {
        botCode('js', aiCode);
      }
    }
  } else {
    bot(`You said: "${t}". Try a command like /help!`);
  }
}
